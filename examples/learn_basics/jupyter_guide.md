# Jupyter Notebook 使用指南

## 📖 界面说明

当你打开 `workflow_by_code.ipynb` 后，会看到：

### 界面组成
```
┌─────────────────────────────────────────────┐
│ File  Edit  View  Insert  Cell  Kernel ... │ ← 菜单栏
├─────────────────────────────────────────────┤
│ ▶ ⏸ ⏹ ↻  [Code ▼]  + ✂ 📋 ⬆ ⬇           │ ← 工具栏
├─────────────────────────────────────────────┤
│                                             │
│  [ ] import qlib                            │ ← Cell 1 (代码块)
│      from qlib.constant import REG_CN       │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│  [ ] qlib.init(...)                         │ ← Cell 2
│                                             │
├─────────────────────────────────────────────┤
│  ...更多 Cells...                           │
└─────────────────────────────────────────────┘
```

### Cell 的状态标识
- `[ ]` - 未运行
- `[*]` - 正在运行
- `[1]` - 已运行（数字表示运行顺序）

## 🚀 基本操作

### 1. 运行单个 Cell

**方法1：点击按钮**
- 点击 Cell 左侧（让它变蓝色/绿色边框）
- 点击工具栏的 ▶ 按钮

**方法2：快捷键（推荐）** ⭐
- 点击 Cell
- 按 `Shift + Enter` - 运行并跳到下一个
- 或按 `Ctrl + Enter` - 运行但停留在当前

### 2. 添加新 Cell
- 点击工具栏的 `+` 按钮
- 或按 `A` (在当前cell上方添加)
- 或按 `B` (在当前cell下方添加)

### 3. 删除 Cell
- 点击 Cell
- 按两次 `D` 键 (D D)

### 4. 停止运行
- 点击工具栏的 ⏹ (停止)按钮
- 或菜单 `Kernel` → `Interrupt`

## 📋 两种模式

Jupyter 有两种模式：

### 命令模式（蓝色边框）
- 按 `Esc` 进入
- 用于导航和执行命令
- 快捷键：
  - `A` - 上方插入cell
  - `B` - 下方插入cell
  - `D D` - 删除cell
  - `M` - 转为Markdown
  - `Y` - 转为代码

### 编辑模式（绿色边框）
- 按 `Enter` 进入
- 用于编辑代码/文本
- 像普通编辑器一样输入代码

## 🎯 运行 workflow_by_code.ipynb 的步骤

### Step 1: 从头开始运行

**方法1：逐个运行（推荐学习时使用）**
1. 点击第一个 Cell
2. 按 `Shift + Enter`
3. 查看输出结果
4. 继续按 `Shift + Enter` 运行下一个
5. 重复直到最后

**方法2：一次性运行全部**
1. 菜单 → `Cell` → `Run All`
2. 等待所有 Cell 运行完成

### Step 2: 理解每个 Cell 的作用

#### Cell 1-2: 环境检查和安装
```python
# 检查 qlib 是否安装
# 如果没有会自动安装
```
运行后看到: `Successfully imported qlib`

#### Cell 3-4: 初始化
```python
# 加载数据
qlib.init(...)
```
运行后看到: 日志信息（数据路径等）

#### Cell 5-7: 训练模型
```python
# 配置和训练 LightGBM 模型
model.fit(dataset)
```
运行后看到:
- 训练进度
- 训练数据形状
- 模型参数

**⏱ 这一步需要几分钟，请耐心等待**

#### Cell 8-9: 回测
```python
# 运行回测
par.generate()
```
运行后看到: 回测完成信息

#### Cell 10-22: 可视化分析 ⭐
```python
# 各种图表
analysis_position.report_graph(...)
```
运行后看到: **图表直接显示在 Cell 下方**

## 📊 会看到的图表

### 图表1: 累积收益曲线
```
Cell 14 运行后显示：
- X轴：日期
- Y轴：累积收益
- 两条线：策略 vs 基准
```

### 图表2: 风险分析
```
Cell 16 运行后显示：
- 最大回撤
- 波动率
- 夏普比率
```

### 图表3: IC 分析
```
Cell 20 运行后显示：
- IC 时间序列
- 平均IC
```

### 图表4: 模型表现
```
Cell 22 运行后显示：
- 分组收益对比
- 长短组合分析
```

## ⚠️ 常见问题

### Q1: Cell 运行很久没反应？
**现象**: `[*]` 一直在转

**原因**:
- 可能是模型训练（正常，需要几分钟）
- 或者卡住了

**解决**:
- 如果是训练，耐心等待
- 如果真卡住，点 ⏹ 停止

### Q2: 报错了怎么办？
**看错误信息**:
```python
NameError: name 'xxx' is not defined
```
→ 说明前面的 Cell 没运行，从头开始

```python
FileNotFoundError: ...
```
→ 数据没下载，检查 Cell 4

### Q3: 图表不显示？
**原因**:
- matplotlib 未安装
- 或需要重新运行

**解决**:
```bash
pip install matplotlib plotly
```

### Q4: 想重新开始？
**菜单操作**:
`Kernel` → `Restart & Clear Output`
→ 清空所有输出，从头运行

## 🎓 学习建议

### 第一次使用：
1. ✅ **逐个运行** - 不要用 Run All
2. ✅ **看输出** - 每个 Cell 运行后看结果
3. ✅ **等待** - 训练需要时间（2-5分钟）
4. ✅ **看图表** - 重点关注可视化部分

### 熟悉后：
1. 修改参数（如 topk, n_drop）
2. 重新运行相关 Cell
3. 对比不同参数的效果

## 🔧 实用快捷键总结

| 快捷键 | 功能 |
|--------|------|
| `Shift + Enter` | 运行当前Cell并跳到下一个 ⭐ |
| `Ctrl + Enter` | 运行当前Cell但不跳转 |
| `Esc` | 进入命令模式 |
| `Enter` | 进入编辑模式 |
| `A` | 上方插入Cell |
| `B` | 下方插入Cell |
| `D D` | 删除Cell |
| `M` | 转为Markdown |
| `Y` | 转为代码 |
| `Ctrl + S` | 保存 |

## 📝 当前任务检查清单

运行 `workflow_by_code.ipynb` 时：

- [ ] Cell 1-2: 环境检查通过
- [ ] Cell 3-4: Qlib 初始化成功
- [ ] Cell 5-7: 模型训练完成（看到 `[7]`）
- [ ] Cell 8-9: 回测完成
- [ ] Cell 10-13: 数据加载成功
- [ ] Cell 14: 看到收益曲线图 📈
- [ ] Cell 16: 看到风险分析图 📊
- [ ] Cell 20: 看到IC分析图 📉
- [ ] Cell 22: 看到模型表现图 📊

## 💡 小技巧

### 技巧1: 查看变量
在任意 Cell 输入变量名，运行查看内容：
```python
# 新建一个 Cell
pred_df.head()  # 查看预测结果
```

### 技巧2: 添加注释
```python
# 这是注释
model.fit(dataset)  # 训练模型
```

### 技巧3: 保存结果
```python
# 保存图表
import matplotlib.pyplot as plt
plt.savefig('my_chart.png')
```

## 🎯 现在就开始！

**建议操作**:
1. 找到第一个 Cell（灰色代码框）
2. 点击它（边框变蓝色）
3. 按 `Shift + Enter`
4. 看输出，继续下一个
5. 重复，直到看到漂亮的图表！

**预计时间**: 5-10分钟（主要是模型训练）
